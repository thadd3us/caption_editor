#!/bin/bash
# Pre-commit hook for caption_editor
# Runs linting and type checking before commits
#
# To install: ln -sf ../../scripts/pre-commit .git/hooks/pre-commit
# Or run: ./scripts/setup-hooks.sh

set -e

echo "ğŸ” Running pre-commit checks..."

# Auto-install dependencies if missing
if [ ! -d "node_modules" ]; then
    echo "ğŸ“¦ Installing npm dependencies..."
    npm install
fi

# TypeScript/JavaScript checks
echo "ğŸ“¦ Checking TypeScript..."
npx tsc --noEmit

echo "ğŸ“¦ Running ESLint..."
npx eslint . --quiet

# Python checks (transcribe directory)
echo "ğŸ Checking Python with ruff..."
cd transcribe
uv run ruff check .
uv run ruff format --check .

echo "ğŸ Running pyright..."
uv run pyright
cd ..

echo "âœ… All pre-commit checks passed!"
